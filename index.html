<!DOCTYPE HTML>
<html>
  <head>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>

	<script type="text/javascript" charset="utf-8">
	
	
	var httpd = null;
	
	

	
    function onDeviceReady() {
		
		alert("Device is ready, setting up http..");
        httpd = ( cordova && cordova.plugins && cordova.plugins.CorHttpd ) ? cordova.plugins.CorHttpd : null;
		
		alert("Starting server..");
		startServer("");
	
    }
	
	
	function onLoad() {
		alert("Document loaded, waiting for device..");
        document.addEventListener("deviceready", onDeviceReady, false);
		//onDeviceReady();
    }
	
	
    function updateStatus() {
        document.getElementById('location').innerHTML = "document.location.href: " + document.location.href;
        if( httpd ) {
          /* use this function to get status of httpd
          * if server is up, it will return http://<server's ip>:port/
          * if server is down, it will return empty string ""
          */
            httpd.getURL(function(url){
                if(url.length > 0) {
                    document.getElementById('url').innerHTML = "server is up: <a href='" + url + "' target='_blank'>" + url + "</a>";
                } else {
                    document.getElementById('url').innerHTML = "server is down.";
                }
            });
            // call this function to retrieve the local path of the www root dir
            httpd.getLocalPath(function(path){
                document.getElementById('localpath').innerHTML = "<br/>localPath: " + path;
            });
        } else {
            alert('CorHttpd plugin not available/ready.');
        }
    }
    function startServer( wwwroot ) {
        if ( httpd ) {
            // before start, check whether its up or not
            httpd.getURL(function(url){
                if(url.length > 0) {
                    //document.getElementById('url').innerHTML = "server is up: <a href='" + url + "' target='_blank'>" + url + "</a>";
					alert("Server is up, starting earth..");
					
					//Start webGL Earth
					initialize();
					
                } else {
                    /* wwwroot is the root dir of web server, it can be absolute or relative path
                    * if a relative path is given, it will be relative to cordova assets/www/ in APK.
                    * "", by default, it will point to cordova assets/www/, it's good to use 'htdocs' for 'www/htdocs'
                    * if a absolute path is given, it will access file system.
                    * "/", set the root dir as the www root, it maybe a security issue, but very powerful to browse all dir
                    */
                    httpd.startServer({
                        'www_root' : wwwroot,
                        'port' : 8080
                    }, function( url ){
                      // if server is up, it will return the url of http://<server ip>:port/
                      // the ip is the active network connection
                      // if no wifi or no cell, "127.0.0.1" will be returned.
                        //document.getElementById('url').innerHTML = "server is started: <a href='" + url + "' target='_blank'>" + url + "</a>";
						
						alert("Server is up, starting earth..");
						
						//Start webGL Earth
						initialize();
						
                    }, function( error ){
                        //document.getElementById('url').innerHTML = 'failed to start server: ' + error;
						alert("failed to start server" + error);
                    });
                }

            });
        } else {
            alert('CorHttpd plugin not available/ready.');
        }
    }
    function stopServer() {
        if ( httpd ) {
            // call this API to stop web server
            httpd.stopServer(function(){
                //document.getElementById('url').innerHTML = 'server is stopped.';
				alert("Server is stopped");
            },function( error ){
                alert("failed to stop server" + error);
				//document.getElementById('url').innerHTML = 'failed to stop server' + error;
            });
        } else {
            alert('CorHttpd plugin not available/ready.');
        }
    }
	
	
	
	</script>
	
	
	
	
	<script src="v2/api.js"></script>
    <script>
	
	
	
	
      function initialize() {
        if (window.location.href.substr(0, 5) === 'file:')
          alert("This file must be accessed via http:// or https:// to run properly.");
		  
		  
        var earth = new WE.map('earth_div');
        earth.setView([46.8011, 8.2266], 2);
        WE.tileLayer('{z}/{x}/{y}.jpg', {
          tileSize: 256,
          bounds: [[-85, -180], [85, 180]],
          minZoom: 0,
          maxZoom: 16,
          attribution: 'WebGLEarth example',
          tms: true
        }).addTo(earth);
      }
    </script>
    <style type="text/css">
      html, body{padding: 0; margin: 0;}
      #earth_div{top: 0; right: 0; bottom: 0; left: 0;
                 position: absolute !important;
                 background-image: -webkit-gradient(
                   linear,
                   left bottom,
                   left top,
                   color-stop(0, rgb(253,253,253)),
                   color-stop(0.15, rgb(253,253,253)),
                   color-stop(0.53, rgb(223,223,223)),
                   color-stop(0.56, rgb(255,255,255)),
                   color-stop(1, rgb(253,253,253))
                   );
                 background-image: -moz-linear-gradient(
                   center bottom,
                   rgb(253,253,253) 0%,
                   rgb(253,253,253) 15%,
                   rgb(223,223,223) 53%,
                   rgb(255,255,255) 56%,
                   rgb(253,253,253) 100%
                   );
      }
    </style>
    <title>WebGL Earth API: Custom Tiles</title>
  </head>
  <body onload="onLoad();">
    <div id="earth_div"></div>
  </body>
</html>